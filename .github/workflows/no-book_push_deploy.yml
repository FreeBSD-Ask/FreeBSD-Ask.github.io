name: ğŸ”— æ— ç”µå­ä¹¦-æ‰‹åŠ¨éƒ¨ç½² GitPage

on: 
  workflow_dispatch:
  
# è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  # æ„å»ºå·¥ä½œ
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Setting TimeZone to UTC+8
        uses: szenius/set-timezone@v2.0
        with:
          timezoneLinux: "Asia/Shanghai"
      - name: Show the timezone
        run: |
           date 
           uname -r
           free -hg
           pwd
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0 # lastUpdated éœ€è¦
          submodules: 'true'    
           
      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - name: Setup Pages
        uses: actions/configure-pages@v5
      - name: ç”Ÿæˆé¦–é¡µ
        run:  cp -a docs/README.md docs/index.md      
      - name: Install dependencies
        run:  bun install 
      - name: Install dependencies
        run:  |
          echo "-----------------------------"
          pwd 
          echo "-----------------------------"
          ls -al
          echo "-----------------------------"
          ls -al docs/
          echo "-----------------------------"
      - name: Build with VitePress
        run:  bun --bun run docs:build

      - name: upload-pages-artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: docs/.vitepress/dist
      - name: Show Usage 
        run: |
         du -h ${{ runner.temp }}/artifact.tar
         echo "-----------------------------"
         du -sh docs/.vitepress/dist
         echo "-----------------------------"
         du -sh docs
         echo "-----------------------------"
         date

        
  # éƒ¨ç½²å·¥ä½œ
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    needs: build
    runs-on: ubuntu-latest
    name: Deploy
    steps:
      - name: Setting TimeZone to UTC+8
        uses: szenius/set-timezone@v2.0
        with:
          timezoneLinux: "Asia/Shanghai"
      - name: Show the timezone
        run: |
           date
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
